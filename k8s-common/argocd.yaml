dex:
  enabled: false

server:
  service:
    type: LoadBalancer
    annotations:
      external-dns.alpha.kubernetes.io/hostname: "${var.environment}.deployments.moove.co.in"
      cloud.google.com/load-balancer-type: Internal

  resources:
    limits:
      cpu: 2
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi

  config:
    url: "https://${var.environment}.deployments.moove.co.in"
    accounts.moove: apiKey, login

  extraArgs:
    - --insecure

  rbacConfig:
    policy.csv: |
      p, role:org-admin, applications, *, */*, allow
      p, role:org-admin, clusters, get, *, allow
      p, role:org-admin, repositories, get, *, allow
      p, role:org-admin, repositories, create, *, allow
      p, role:org-admin, repositories, update, *, allow
      p, role:org-admin, repositories, delete, *, allow
      p, role:deploy-user, applications, get, */*, allow
      p, role:deploy-user, applications, sync, */*, allow
      p, role:deploy-user, applications, update, */*, allow
      p, role:deploy-user, clusters, get, *, allow
      p, role:deploy-user, repositories, get, *, allow
      g, moove, role:org-admin
      g, alex, role:org-admin
    policy.default: role:''

redis:
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 64Mi

repoServer:
  resources:
    limits:
      cpu: 2
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi

notifications:
  enabled: true
  name: notifications-controller
  argocdUrl: "https://${var.environment}.deployments.moove.co.in"

  resources: {}

  serviceAccount:
    create: true
    name: argocd-notifications-controller
    annotations: {}

  cm:
    create: true
    name: "argocd-notifications-cm"

  secret:
    create: false
    name: "${local.notification_secret}"

  notifiers:
    service.grafana: |
      apiUrl: https://grafana.moove.ai/api
      apiKey: $grafana_api_key
    service.slack: |
      token: $slack_token
      username: devopsbot

  subscriptions:
    - recipients:
      - slack:devops-bots-test
      - slack:devops-bots
      triggers:
      - on-sync-status-unknown
      - on-sync-operation-change

  templates:
    template.app-deployed: |
      message: |
        {{if eq .serviceType "slack"}}:white_check_mark:{{end}} Application {{.app.metadata.name}} is now running new version of deployments manifests.
      slack:
        attachments: |
          [{
            "title": "{{ .app.metadata.name}}",
            "title_link":"{{.context.argocdUrl}}/applications/{{.app.metadata.name}}",
            "color": "#18be52",
            "fields": [
            {
              "title": "Sync Status",
              "value": "{{.app.status.sync.status}}",
              "short": true
            },
            {
              "title": "Repository",
              "value": "{{.app.spec.source.repoURL}}",
              "short": true
            },
            {
              "title": "Revision",
              "value": "{{.app.status.sync.revision}}",
              "short": true
            }]
          }]